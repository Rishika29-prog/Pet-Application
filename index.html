<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Happy Birthday ‚ù§Ô∏è ‚Äì Treasure Hunt</title>
  <style>
    :root {
      --primary: #d6336c; /* rose */
      --bg1: #fff0f6; /* light rose */
      --bg2: #fff5e6; /* light peach */
      --ink: #2b2b2b;
      --card: #ffffffdd;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; }
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--ink);
      background: linear-gradient(135deg, var(--bg1), var(--bg2));
      overflow-x: hidden;
    }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 24px; }
    .center { display: flex; align-items: center; justify-content: center; text-align: center; }
    .hidden { display: none !important; }

    .card {
      background: var(--card);
      backdrop-filter: blur(6px);
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,.08);
      padding: 24px;
    }
    h1 { font-size: clamp(28px, 4vw, 48px); margin: 0 0 12px; color: var(--primary); }
    h2 { font-size: clamp(20px, 3vw, 28px); margin: 0 0 16px; }
    p { font-size: 18px; line-height: 1.5; }

    button {
      appearance: none; border: 0; cursor: pointer;
      background: var(--primary); color: #fff; font-weight: 600;
      padding: 12px 20px; border-radius: 12px; font-size: 16px;
      box-shadow: 0 6px 16px rgba(214,51,108,.35);
      transition: transform .06s ease, box-shadow .2s ease, opacity .2s ease;
    }
    button:hover { transform: translateY(-1px); box-shadow: 0 10px 24px rgba(214,51,108,.45); }
    button:active { transform: translateY(1px); }
    .ghost-btn { background:#fff; color: var(--primary); border: 2px solid var(--primary); }

    .countdown {
      font-size: clamp(48px, 12vw, 120px);
      font-weight: 800;
      letter-spacing: -2px;
      color: var(--primary);
    }

    .stack { display: grid; gap: 16px; }

    .stage { min-height: 70vh; display: grid; place-items: center; }

    .flex-row { display: flex; gap: 12px; flex-wrap: wrap; justify-content: center; }

    /* Balloon pop */
    .sky { position: relative; width: 100%; height: 60vh; overflow: hidden; background: linear-gradient(#e0f7ff,#f7fbff); border-radius: 16px; }
    .balloon {
      --x: 0; --d: 8s; --size: 70px; --hue: 340;
      position: absolute; bottom: -100px; left: var(--x);
      width: var(--size); height: calc(var(--size)*1.25);
      background: hsl(var(--hue) 80% 60%);
      border-radius: 50% 50% 45% 45% / 60% 60% 40% 40%;
      box-shadow: inset -8px -10px 0 rgba(0,0,0,.1);
      animation: rise var(--d) linear forwards;
      cursor: pointer;
    }
    .balloon:after { content:""; position:absolute; bottom:-14px; left:50%; transform:translateX(-50%);
      width: 2px; height: 30px; background: rgba(0,0,0,.15);
    }
    @keyframes rise { to { transform: translateY(-85vh); opacity: 1; } }

    /* Memory match */
    .grid { display: grid; gap: 10px; grid-template-columns: repeat(4, minmax(70px, 120px)); justify-content: center; }
    .tile { width: 100%; aspect-ratio: 1; border-radius: 16px; background: #fff; box-shadow: 0 6px 16px rgba(0,0,0,.08); display: grid; place-items: center; font-size: 36px; cursor: pointer; }
    .tile.revealed { background: #ffe9f1; }
    .tile.matched { background: #d1fae5; }

    /* Sliding puzzle (3x3) */
    .puzzle { width: min(92vw, 420px); height: min(92vw, 420px); margin: 0 auto; display: grid; grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(3, 1fr); gap: 6px; }
    .piece { position: relative; border-radius: 10px; overflow: hidden; background: #fff; cursor: pointer; box-shadow: 0 6px 12px rgba(0,0,0,.08); }
    .piece img { position: absolute; width: 300%; height: 300%; object-fit: cover; top: 0; left: 0; user-select: none; pointer-events: none; }
    .piece.empty { background: repeating-linear-gradient(45deg,#f3f3f3,#f3f3f3 10px,#ffffff 10px,#ffffff 20px); cursor: default; box-shadow: none; }

    /* Slideshow */
    .slideshow { display: grid; gap: 12px; }
    .slideshow img { max-width: 100%; max-height: 60vh; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,.12); }

    /* Confetti (simple) */
    .confetti { position: fixed; inset: 0; pointer-events: none; overflow: hidden; }
    .confetti i{ position:absolute; width:10px; height:16px; background: hsl(var(--h) 90% 60%); top:-20px; left:var(--l); transform: rotate(var(--r)); animation: fall 3.2s ease-in infinite; }
    @keyframes fall { 70%{ transform: translateY(95vh) rotate(300deg);} 100%{ transform: translateY(110vh) rotate(360deg);} }

    .note { font-size: 14px; opacity: .8; }
  </style>
</head>
<body>
  <div class="wrap">
    <!-- Stage 0: Countdown -->
    <section id="stage-countdown" class="stage">
      <div class="card center stack">
        <h1>Countdown to the Surprise üéâ</h1>
        <div id="countdown" class="countdown">10</div>
        <p class="note">(Keep watching üëÄ)</p>
      </div>
    </section>

    <!-- Stage 1: Greeting + Start -->
    <section id="stage-greeting" class="stage hidden">
      <div class="card stack center">
        <h1>Happy Birthday, My Love ‚ù§Ô∏è</h1>
        <p>Three years down, a lifetime to go. Ready to play a little game and unlock your gifts? üóùÔ∏èüéÅ</p>
        <div class="flex-row">
          <button id="btn-begin">Begin the Adventure</button>
          <button class="ghost-btn" id="btn-skip">Skip games ‚Üí Slideshow</button>
        </div>
        <p class="note">(Music will start after you click. No autoplay üôÇ)</p>
      </div>
    </section>

    <!-- Stage 2: Game Navigator (5 steps) -->
    <section id="stage-games" class="stage hidden">
      <div class="stack" style="width:100%">
        <div class="card center stack">
          <h2>Level <span id="level-num">1</span> / 5</h2>
          <p id="level-title"><strong>Game 1:</strong> Solve the photo puzzle to reveal your first gift clue.</p>
        </div>

        <!-- Game containers (only one visible at a time) -->
        <div id="game-puzzle" class="card">
          <div class="puzzle" id="puzzle"></div>
          <p class="note">Arrange pieces to form the photo. Click a tile next to the empty spot to slide.</p>
        </div>

        <div id="game-quiz" class="card hidden">
          <h3>Us Trivia üíë</h3>
          <p id="quiz-q">Question text</p>
          <div id="quiz-opts" class="stack"></div>
        </div>

        <div id="game-balloons" class="card hidden">
          <h3>Pop a Balloon üéà</h3>
          <p>One of these balloons hides your clue. Pop until you find it!</p>
          <div class="sky" id="sky"></div>
        </div>

        <div id="game-memory" class="card hidden">
          <h3>Memory Match üß†</h3>
          <div class="grid" id="memory-grid"></div>
        </div>

        <div id="game-song" class="card hidden center stack">
          <h3>Finale üéµ</h3>
          <p>Hit play to start the song and your slideshow of memories.</p>
          <div class="flex-row"><button id="btn-play">Play</button></div>
        </div>

        <div id="clue" class="card hidden"></div>
        <div class="flex-row">
          <button id="btn-next" class="hidden">Next ‚Üí</button>
        </div>
      </div>
    </section>

    <!-- Stage 3: Slideshow Finale -->
    <section id="stage-slideshow" class="stage hidden">
      <div class="card slideshow center">
        <h2>Our Memories Together üíñ</h2>
        <img id="slide" src="" alt="Our photo"/>
        <div class="flex-row">
          <button id="btn-prev">‚üµ Prev</button>
          <button id="btn-pause">Pause</button>
          <button id="btn-next-slide">Next ‚ü∂</button>
        </div>
        <p class="note">Tip: Add your photos in <code>photos/</code> and a song in <code>music/song.mp3</code>.</p>
      </div>
    </section>
  </div>

  <!-- Music (user gesture will start it) -->
  <audio id="bgm" src="music/song.mp3" preload="auto"></audio>

  <!-- Confetti container -->
  <div id="confetti" class="confetti"></div>

  <script>
    /********************
     * CONFIG ‚Äì Edit these to personalize
     ********************/
    const HUSBAND_NAME = "My Love"; // e.g., "Arjun"

    // Photo used for the sliding puzzle (3x3). Put one image at this path.
    const PUZZLE_IMAGE = "photos/puzzle.jpg"; // 1200x1200 recommended

    // Slideshow photos (add your files in /photos)
    const SLIDES = [
      "photos/photo1.jpg",
      "photos/photo2.jpg",
      "photos/photo3.jpg",
      "photos/photo4.jpg",
      "photos/photo5.jpg"
    ];

    // Five clues for five gifts (these show after each game success)
    const GIFT_CLUES = [
      "üéÅ Gift #1 is waiting under the sofa!",
      "üéÅ Gift #2 is chilling in the fridge (top shelf).",
      "üéÅ Gift #3 hides where you keep your favorite books.",
      "üéÅ Gift #4 is inside the wardrobe, left drawer.",
      "üéÅ Gift #5: Check the balcony table under the planter."
    ];

    // Trivia questions (keep it sweet & easy!)
    const QUIZ = [
      {
        q: "Our first trip together was to‚Ä¶",
        options: ["Goa", "Ooty", "Jaipur", "Mysuru"],
        answer: 0
      },
      {
        q: "Your specialty that I love the most is‚Ä¶",
        options: ["Pasta", "Biryani", "Maggi", "Tea"],
        answer: 3
      },
      {
        q: "Our movie date I can rewatch any day‚Ä¶",
        options: ["3 Idiots", "Barfi!", "Tamasha", "Jab We Met"],
        answer: 1
      }
    ];

    // Memory match symbols (pairs)
    const MEM_EMOJIS = ["üíò","üíò","üéà","üéà","üç∞","üç∞","üì∏","üì∏","üåü","üåü","üéÅ","üéÅ"]; // 6 pairs

    /********************
     * UTILITIES
     ********************/
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));
    const wait = ms => new Promise(r => setTimeout(r, ms));

    function shuffle(arr){
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function celebrate(){
      // lightweight confetti
      const box = $("#confetti");
      box.innerHTML = "";
      const n = 120;
      for(let i=0;i<n;i++){
        const piece = document.createElement('i');
        piece.style.setProperty('--l', Math.random()*100+'%');
        piece.style.setProperty('--r', (Math.random()*360)+'deg');
        piece.style.setProperty('--h', Math.floor(Math.random()*360));
        piece.style.animationDelay = (Math.random()*1.2)+'s';
        box.appendChild(piece);
      }
      setTimeout(()=> box.innerHTML = "", 4000);
    }

    /********************
     * FLOW ‚Äì Stages
     ********************/
    const stageCountdown = $("#stage-countdown");
    const stageGreeting  = $("#stage-greeting");
    const stageGames     = $("#stage-games");
    const stageShow      = $("#stage-slideshow");

    const levelNum   = $("#level-num");
    const levelTitle = $("#level-title");
    const clueBox    = $("#clue");
    const btnNext    = $("#btn-next");
    const bgm        = $("#bgm");

    // Countdown
    let counter = 10;
    const countdownEl = $("#countdown");
    const cInterval = setInterval(()=>{
      counter--; countdownEl.textContent = counter;
      if(counter <= 0){ clearInterval(cInterval); showGreeting(); celebrate(); }
    }, 1000);

    function showGreeting(){
      stageCountdown.classList.add('hidden');
      stageGreeting.classList.remove('hidden');
      // Personalize headline
      stageGreeting.querySelector('h1').textContent = `Happy Birthday, ${HUSBAND_NAME} ‚ù§Ô∏è`;
    }

    $("#btn-begin").addEventListener('click', async ()=>{
      stageGreeting.classList.add('hidden');
      stageGames.classList.remove('hidden');
      try { await bgm.play(); } catch(e) {/* user can play later */}
      startLevel(0);
    });

    $("#btn-skip").addEventListener('click', ()=>{
      // Direct to slideshow
      showSlideshow();
    });

    function startLevel(i){
      currentLevel = i;
      levelNum.textContent = i+1;
      clueBox.classList.add('hidden');
      btnNext.classList.add('hidden');
      $$('#game-puzzle, #game-quiz, #game-balloons, #game-memory, #game-song').forEach(el=>el.classList.add('hidden'));

      const titles = [
        "Game 1: Solve the photo puzzle to reveal your first gift clue.",
        "Game 2: A tiny trivia about us üíë",
        "Game 3: Pop the balloon hiding your clue üéà",
        "Game 4: Match the pairs to unlock the next hint",
        "Finale: Hit play to start the music & slideshow"
      ];
      levelTitle.innerHTML = `<strong>${titles[i]}</strong>`;

      switch(i){
        case 0: initPuzzle(); $("#game-puzzle").classList.remove('hidden'); break;
        case 1: initQuiz(); $("#game-quiz").classList.remove('hidden'); break;
        case 2: initBalloons(); $("#game-balloons").classList.remove('hidden'); break;
        case 3: initMemory(); $("#game-memory").classList.remove('hidden'); break;
        case 4: initSongFinale(); $("#game-song").classList.remove('hidden'); break;
      }
    }

    btnNext.addEventListener('click', ()=>{
      if(currentLevel < 4) startLevel(currentLevel+1); else showSlideshow();
    });

    function revealClue(i){
      clueBox.classList.remove('hidden');
      clueBox.innerHTML = `<h3>Clue unlocked!</h3><p>${GIFT_CLUES[i]}</p>`;
      celebrate();
      btnNext.classList.remove('hidden');
      window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    }

    /********************
     * GAME 1 ‚Äì Sliding Puzzle (3x3)
     ********************/
    let puzzleState = []; // numbers 0..8 (0 is empty)
    let currentLevel = 0;

    function initPuzzle(){
      const size = 3;
      const total = size*size; // 9
      // create solvable puzzle (random even inversions for 3x3)
      do {
        puzzleState = shuffle([...Array(total).keys()]);
      } while(!isSolvable(puzzleState));
      renderPuzzle();
    }

    function isSolvable(arr){
      // 3x3 solvable if inversions even
      let inv = 0;
      for(let i=0;i<arr.length;i++) for(let j=i+1;j<arr.length;j++) if(arr[i] && arr[j] && arr[i]>arr[j]) inv++;
      return inv % 2 === 0;
    }

    function renderPuzzle(){
      const container = $("#puzzle");
      container.innerHTML = "";
      const size = 3, step = 100/ (size-1);
      puzzleState.forEach((val, idx)=>{
        const r = Math.floor(idx/3), c = idx%3;
        const piece = document.createElement('div');
        piece.className = 'piece' + (val===0 ? ' empty' : '');
        if(val!==0){
          const img = document.createElement('img');
          img.src = PUZZLE_IMAGE;
          const rr = Math.floor((val)/3), cc = (val)%3; // correct pos
          img.style.left = `-${cc*100}%`;
          img.style.top  = `-${rr*100}%`;
          container.appendChild(piece);
          piece.appendChild(img);
        } else {
          container.appendChild(piece);
        }
        piece.addEventListener('click', ()=>movePiece(idx));
      });
    }

    function movePiece(idx){
      const emptyIdx = puzzleState.indexOf(0);
      const canMove = [idx-3, idx+3, idx-1, idx+1].includes(emptyIdx) && !(idx%3===0 && emptyIdx===idx-1) && !(idx%3===2 && emptyIdx===idx+1);
      if(!canMove) return;
      [puzzleState[idx], puzzleState[emptyIdx]] = [puzzleState[emptyIdx], puzzleState[idx]];
      renderPuzzle();
      if(isSolved()) revealClue(0);
    }

    function isSolved(){
      for(let i=0;i<puzzleState.length;i++) if(puzzleState[i]!==i) return false; return true;
    }

    /********************
     * GAME 2 ‚Äì Quiz
     ********************/
    function initQuiz(){
      const q = QUIZ[Math.floor(Math.random()*QUIZ.length)];
      $("#quiz-q").textContent = q.q;
      const opts = $("#quiz-opts");
      opts.innerHTML = "";
      q.options.forEach((opt, i)=>{
        const b = document.createElement('button');
        b.textContent = opt;
        b.className = 'ghost-btn';
        b.addEventListener('click', ()=>{
          if(i===q.answer){ b.textContent = '‚úì ' + opt + ' ‚Äî Correct!'; revealClue(1); }
          else { b.textContent = '‚úó Try again üòò'; }
        });
        opts.appendChild(b);
      });
    }

    /********************
     * GAME 3 ‚Äì Balloon Pop
     ********************/
    function initBalloons(){
      const sky = $("#sky"); sky.innerHTML = "";
      const total = 12; const secret = Math.floor(Math.random()*total);
      for(let i=0;i<total;i++){
        const div = document.createElement('div');
        div.className = 'balloon';
        div.style.setProperty('--x', (5 + Math.random()*90)+'%');
        div.style.setProperty('--d', (6 + Math.random()*6)+'s');
        div.style.setProperty('--size', (60 + Math.random()*50)+'px');
        div.style.setProperty('--hue', Math.floor(Math.random()*360));
        div.title = 'Pop!';
        div.addEventListener('click', ()=>{
          div.style.opacity = .2; div.style.pointerEvents = 'none';
          if(i===secret){ revealClue(2); }
        });
        sky.appendChild(div);
      }
    }

    /********************
     * GAME 4 ‚Äì Memory Match
     ********************/
    function initMemory(){
      const grid = $("#memory-grid");
      grid.innerHTML = "";
      const items = shuffle([...MEM_EMOJIS]);
      let first=null, lock=false, matched=0;
      items.forEach((emoji, idx)=>{
        const tile = document.createElement('button');
        tile.className = 'tile';
        tile.setAttribute('data-idx', idx);
        tile.setAttribute('aria-label','card');
        tile.textContent = "";
        tile.addEventListener('click', ()=>{
          if(lock || tile.classList.contains('matched') || tile.classList.contains('revealed')) return;
          tile.classList.add('revealed'); tile.textContent = emoji;
          if(!first){ first = {tile, emoji}; return; }
          // second
          if(first.emoji === emoji){
            tile.classList.add('matched'); first.tile.classList.add('matched');
            matched += 2; first=null; celebrate();
            if(matched === items.length){ revealClue(3); }
          } else {
            lock = true; setTimeout(()=>{
              tile.classList.remove('revealed'); tile.textContent = "";
              first.tile.classList.remove('revealed'); first.tile.textContent = "";
              first=null; lock=false;
            }, 650);
          }
        });
        grid.appendChild(tile);
      });
    }

    /********************
     * GAME 5 ‚Äì Song + Slideshow trigger
     ********************/
    function initSongFinale(){
      $("#btn-play").onclick = async ()=>{
        try { await bgm.play(); } catch(e) {}
        revealClue(4);
      };
    }

    /********************
     * SLIDESHOW
     ********************/
    let slideIdx = 0, slideTimer=null, playing=true;

    function showSlideshow(){
      stageGames.classList.add('hidden');
      stageGreeting.classList.add('hidden');
      stageShow.classList.remove('hidden');
      loadSlide(0);
      autoPlay();
    }

    function loadSlide(i){
      slideIdx = (i+SLIDES.length)%SLIDES.length;
      $("#slide").src = SLIDES[slideIdx];
    }

    function autoPlay(){
      playing = true; $("#btn-pause").textContent = 'Pause';
      slideTimer && clearInterval(slideTimer);
      slideTimer = setInterval(()=> loadSlide(slideIdx+1), 4000);
    }

    $("#btn-prev").addEventListener('click', ()=>{ loadSlide(slideIdx-1); });
    $("#btn-next-slide").addEventListener('click', ()=>{ loadSlide(slideIdx+1); });
    $("#btn-pause").addEventListener('click', ()=>{
      if(playing){ clearInterval(slideTimer); playing=false; $("#btn-pause").textContent='Play'; }
      else { autoPlay(); }
    });
  </script>
</body>
</html>
